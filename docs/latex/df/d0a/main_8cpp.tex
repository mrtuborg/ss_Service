\hypertarget{main_8cpp}{
\section{src/main.cpp File Reference}
\label{df/d0a/main_8cpp}\index{src/main.cpp@{src/main.cpp}}
}


Programm entry point.  


{\ttfamily \#include $<$stdio.h$>$}\par
{\ttfamily \#include $<$stdlib.h$>$}\par
{\ttfamily \#include $<$string.h$>$}\par
{\ttfamily \#include $<$arpa/inet.h$>$}\par
{\ttfamily \#include $<$pthread.h$>$}\par
{\ttfamily \#include $<$signal.h$>$}\par
{\ttfamily \#include $<$sys/reboot.h$>$}\par
{\ttfamily \#include $<$deque$>$}\par
{\ttfamily \#include \char`\"{}../../rcsLib/ortsTypes/ortsTypes.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}buffer/ssBuffer.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}../../udp\_\-port/udp\_\-port.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}arg\_\-parser/carg\_\-parser.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}console\_\-out.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}../../rcsLib/rcsCmd/rcsCmd.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}ICAppLayer/FunctionNode/param\_\-desc.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}ICAppLayer/FunctionNode/FunctionNode.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}ICAppLayer/ICAppLayer.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}Functions/CommonFuncs.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}Functions/SpecFuncs.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}Functions/functions.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}SIG\_\-handler.h\char`\"{}}\par
{\ttfamily \#include \char`\"{}global.h\char`\"{}}\par
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
errType \hyperlink{main_8cpp_ac215f0f8771618eaf8c6ec7eb8f351d7}{process\_\-cmdLine} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em Parsing commandline arguments. \item\end{DoxyCompactList}\item 
errType \hyperlink{main_8cpp_a593fb7bc2ab0c4844f7d5e6f782e1809}{fileRead} (char $\ast$fname, BYTE $\ast$$\ast$\hyperlink{classbuffer}{buffer}, size\_\-t $\ast$sz)
\begin{DoxyCompactList}\small\item\em useless function in this programm. \item\end{DoxyCompactList}\item 
void \hyperlink{main_8cpp_aa826989c29ffd5838253ec6f620a9f84}{dbg\_\-hex\_\-print} (BYTE $\ast$\hyperlink{classbuffer}{buffer}, size\_\-t len)
\begin{DoxyCompactList}\small\item\em prints hex bytes from {\itshape buffer\/} with size {\itshape len\/}. \item\end{DoxyCompactList}\item 
errType \hyperlink{main_8cpp_ad68e81ce983cbcdbee68c1a830fdd873}{appInit} (void)
\begin{DoxyCompactList}\small\item\em Initialize \hyperlink{classsrvAppLayer}{srvAppLayer} subsystem. \item\end{DoxyCompactList}\item 
errType \hyperlink{main_8cpp_ae8ab369e8636d4e3acc74467f94036ab}{appDeinit} (void)
\begin{DoxyCompactList}\small\item\em Deinitialize \hyperlink{classsrvAppLayer}{srvAppLayer} subsystem. \item\end{DoxyCompactList}\item 
int \hyperlink{main_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{main} (int argc, char $\ast$argv\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em Programm entrypoint. \item\end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Programm entry point. \begin{DoxyAuthor}{Author}
Vladimir A. Nosenko (\href{mailto:nosenko@ieee.org}{\tt nosenko@ieee.org}) 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
December, 2010
\end{DoxyDate}
Copyright (c) 2010 Vladimir A.Nosenko.

The license and distribution terms for this file may be found in the file LICENSE in this distribution 

Definition in file \hyperlink{main_8cpp_source}{main.cpp}.



\subsection{Function Documentation}
\hypertarget{main_8cpp_ac215f0f8771618eaf8c6ec7eb8f351d7}{
\index{main.cpp@{main.cpp}!process\_\-cmdLine@{process\_\-cmdLine}}
\index{process\_\-cmdLine@{process\_\-cmdLine}!main.cpp@{main.cpp}}
\subsubsection[{process\_\-cmdLine}]{\setlength{\rightskip}{0pt plus 5cm}errType process\_\-cmdLine (
\begin{DoxyParamCaption}
\item[{int}]{ argc, }
\item[{char $\ast$}]{ argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}
\label{df/d0a/main_8cpp_ac215f0f8771618eaf8c6ec7eb8f351d7}


Parsing commandline arguments. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\tt in}  & {\em argc} & -\/ count of arguments strings \\
\hline
\mbox{\tt in}  & {\em argv\mbox{[}$\,$\mbox{]}} & -\/ array of arguments strings\\
\hline
\end{DoxyParams}

\begin{DoxyRetVals}{Return values}
{\em err\_\-result\_\-ok} & -\/ if execution was successful \\
\hline
{\em err\_\-not\_\-found} & -\/ if no arguments found \\
\hline
{\em err\_\-result\_\-error} & -\/ if parsing was unsuccessful \\
\hline
\end{DoxyRetVals}


\begin{Desc}
\item[\hyperlink{todo__todo000012}{Todo}]reorganize process to external library \end{Desc}


1. Define arguments type: with ({\itshape ap\_\-yes\/}) or without ({\itshape ap\_\-no\/}) parameters

2. Initialize arguments parser \hyperlink{carg__parser_8h_a17ea4588142cd924979247065ee879a5}{ap\_\-init}

3. Check for parsing errors \hyperlink{carg__parser_8h_afd8cfd6a35982dd8d0194f972225b8a4}{ap\_\-error}

4. Execute all arguments after it parsing


\begin{DoxyItemize}
\item get code of argument \hyperlink{carg__parser_8h_a35a7279617ae46ff95726c08d1b90f6c}{ap\_\-code}
\end{DoxyItemize}


\begin{DoxyItemize}
\item switch with argument code value
\end{DoxyItemize}


\begin{DoxyItemize}
\item execute
\end{DoxyItemize}

4. Execute only arguments with parameters after it parsing


\begin{DoxyItemize}
\item get code of argument \hyperlink{carg__parser_8h_a35a7279617ae46ff95726c08d1b90f6c}{ap\_\-code}
\end{DoxyItemize}


\begin{DoxyItemize}
\item get argument parameter \hyperlink{carg__parser_8h_a817f558f9a6fcda87ceb7a2d9c267654}{ap\_\-argument}
\end{DoxyItemize}


\begin{DoxyItemize}
\item switch with argument code value
\end{DoxyItemize}


\begin{DoxyItemize}
\item execute 
\end{DoxyItemize}



Definition at line 51 of file main.cpp.



References ap\_\-argument(), ap\_\-arguments(), ap\_\-code(), ap\_\-error(), ap\_\-init(), ap\_\-no, ap\_\-yes, eq\_\-ip\_\-addr, eq\_\-udp\_\-listen\_\-port, eq\_\-udp\_\-sending\_\-port, equipAddr, internal\_\-error(), show\_\-error(), show\_\-help(), show\_\-version(), verbose\_\-level, and wUdp.



Referenced by main().



Here is the call graph for this function:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=400pt]{df/d0a/main_8cpp_ac215f0f8771618eaf8c6ec7eb8f351d7_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=270pt]{df/d0a/main_8cpp_ac215f0f8771618eaf8c6ec7eb8f351d7_icgraph}
\end{center}
\end{figure}


\hypertarget{main_8cpp_a593fb7bc2ab0c4844f7d5e6f782e1809}{
\index{main.cpp@{main.cpp}!fileRead@{fileRead}}
\index{fileRead@{fileRead}!main.cpp@{main.cpp}}
\subsubsection[{fileRead}]{\setlength{\rightskip}{0pt plus 5cm}errType fileRead (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{ fname, }
\item[{BYTE $\ast$$\ast$}]{ buffer, }
\item[{size\_\-t $\ast$}]{ sz}
\end{DoxyParamCaption}
)}}
\label{df/d0a/main_8cpp_a593fb7bc2ab0c4844f7d5e6f782e1809}


useless function in this programm. 

stays from good old times 

\begin{Desc}
\item[\hyperlink{todo__todo000013}{Todo}]reorganize function to reading xml-\/files for future purposes \end{Desc}




Definition at line 147 of file main.cpp.

\hypertarget{main_8cpp_aa826989c29ffd5838253ec6f620a9f84}{
\index{main.cpp@{main.cpp}!dbg\_\-hex\_\-print@{dbg\_\-hex\_\-print}}
\index{dbg\_\-hex\_\-print@{dbg\_\-hex\_\-print}!main.cpp@{main.cpp}}
\subsubsection[{dbg\_\-hex\_\-print}]{\setlength{\rightskip}{0pt plus 5cm}void dbg\_\-hex\_\-print (
\begin{DoxyParamCaption}
\item[{BYTE $\ast$}]{ buffer, }
\item[{size\_\-t}]{ len}
\end{DoxyParamCaption}
)}}
\label{df/d0a/main_8cpp_aa826989c29ffd5838253ec6f620a9f84}


prints hex bytes from {\itshape buffer\/} with size {\itshape len\/}. 



\begin{Desc}
\item[\hyperlink{todo__todo000014}{Todo}]use this function in new debug print system \end{Desc}




Definition at line 188 of file main.cpp.

\hypertarget{main_8cpp_ad68e81ce983cbcdbee68c1a830fdd873}{
\index{main.cpp@{main.cpp}!appInit@{appInit}}
\index{appInit@{appInit}!main.cpp@{main.cpp}}
\subsubsection[{appInit}]{\setlength{\rightskip}{0pt plus 5cm}errType appInit (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}
\label{df/d0a/main_8cpp_ad68e81ce983cbcdbee68c1a830fdd873}


Initialize \hyperlink{classsrvAppLayer}{srvAppLayer} subsystem. 

result copied from \hyperlink{classsrvAppLayer_acde5f9e1287ca5206957c64354d1aa8f}{srvAppLayer::StartListening} 
\begin{DoxyRetVals}{Return values}
{\em err\_\-result\_\-ok} & -\/ execution was successful \\
\hline
{\em err\_\-sock\_\-error} & -\/ problems with communications subsystem \\
\hline
\end{DoxyRetVals}


Starting main programm threads \hyperlink{classsrvAppLayer_acde5f9e1287ca5206957c64354d1aa8f}{srvAppLayer::StartListening()}:
\begin{DoxyEnumerate}
\item Prepare queues for sending and listening to/from clients
\item Send \& Listen threads for clients communication
\item Listen thread for equipment communication
\end{DoxyEnumerate}

If threads started successfully -\/ starts service specific function initialize srvInit()



Definition at line 203 of file main.cpp.



References app, srvAppLayer::StartListening(), and verbose\_\-level.



Referenced by main().



Here is the call graph for this function:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=400pt]{df/d0a/main_8cpp_ad68e81ce983cbcdbee68c1a830fdd873_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=214pt]{df/d0a/main_8cpp_ad68e81ce983cbcdbee68c1a830fdd873_icgraph}
\end{center}
\end{figure}


\hypertarget{main_8cpp_ae8ab369e8636d4e3acc74467f94036ab}{
\index{main.cpp@{main.cpp}!appDeinit@{appDeinit}}
\index{appDeinit@{appDeinit}!main.cpp@{main.cpp}}
\subsubsection[{appDeinit}]{\setlength{\rightskip}{0pt plus 5cm}errType appDeinit (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}
\label{df/d0a/main_8cpp_ae8ab369e8636d4e3acc74467f94036ab}


Deinitialize \hyperlink{classsrvAppLayer}{srvAppLayer} subsystem. 


\begin{DoxyRetVals}{Return values}
{\em always} & return err\_\-result\_\-ok, why not? \\
\hline
\end{DoxyRetVals}


Definition at line 230 of file main.cpp.



References app, and srvAppLayer::StopListening().



Referenced by main().



Here is the call graph for this function:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=348pt]{df/d0a/main_8cpp_ae8ab369e8636d4e3acc74467f94036ab_cgraph}
\end{center}
\end{figure}




Here is the caller graph for this function:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=230pt]{df/d0a/main_8cpp_ae8ab369e8636d4e3acc74467f94036ab_icgraph}
\end{center}
\end{figure}


\hypertarget{main_8cpp_a0ddf1224851353fc92bfbff6f499fa97}{
\index{main.cpp@{main.cpp}!main@{main}}
\index{main@{main}!main.cpp@{main.cpp}}
\subsubsection[{main}]{\setlength{\rightskip}{0pt plus 5cm}int main (
\begin{DoxyParamCaption}
\item[{int}]{ argc, }
\item[{char $\ast$}]{ argv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}
\label{df/d0a/main_8cpp_a0ddf1224851353fc92bfbff6f499fa97}


Programm entrypoint. 


\begin{DoxyRetVals}{Return values}
{\em EXIT\_\-FAILURE} & \\
\hline
{\em err\_\-not\_\-init} & \\
\hline
\end{DoxyRetVals}


1. Process command line arguments {\bfseries argc} and {\bfseries argv}\mbox{[}\mbox{]} in \hyperlink{main_8cpp_ac215f0f8771618eaf8c6ec7eb8f351d7}{process\_\-cmdLine}


\begin{DoxyItemize}
\item if arguments parsing is unsuccessfull exiting from programm
\end{DoxyItemize}

2. Check arguments:
\begin{DoxyItemize}
\item check for missing one of exact argument
\end{DoxyItemize}


\begin{DoxyItemize}
\item check for equipment communication settings:
\begin{DoxyItemize}
\item sending port need to be not equal to listen port values
\item sending or listen port neet to be not equal to client listen port
\end{DoxyItemize}
\end{DoxyItemize}


\begin{DoxyItemize}
\item check for sending port number or listening port number was far from client port number on one port number that reserved for client sending port.
\end{DoxyItemize}

3. Install system signals handlers \hyperlink{SIG__handler_8cpp_aaf331ac25636e1cc35703d0b4aea5dc6}{installSIGhandlers()}

4. Initialize application \hyperlink{main_8cpp_ad68e81ce983cbcdbee68c1a830fdd873}{appInit()}

4. Start functions generate from declarations
\begin{DoxyItemize}
\item for common functions \hyperlink{classcommonFuncsMgr_a9bd0bd8c733b05611a2d013811b45351}{commonFuncsMgr::startCommonFuncs()}
\end{DoxyItemize}


\begin{DoxyItemize}
\item for special functions \hyperlink{classspecFuncsMgr_a73d45791bdd32eaf44340f26401fc74c}{specFuncsMgr::startSpecFuncs()}
\end{DoxyItemize}

5. Main programm loop \hyperlink{classsrvAppLayer_a51173210a4569e0044efa91eb7089541}{srvAppLayer::ProcessMessages()} while not terminated by signal \hyperlink{classsrvAppLayer_a8dff3da333c073ffa5e535161cdf8395}{srvAppLayer::terminated()}

6. Deinitialize application \hyperlink{main_8cpp_ae8ab369e8636d4e3acc74467f94036ab}{appDeinit()} 



Definition at line 244 of file main.cpp.



References app, appDeinit(), appInit(), AppTerminated, eq\_\-udp\_\-listen\_\-port, eq\_\-udp\_\-sending\_\-port, equipAddr, installSIGhandlers(), process\_\-cmdLine(), srvAppLayer::ProcessMessages(), commonFuncsMgr::startCommonFuncs(), specFuncsMgr::startSpecFuncs(), srvAppLayer::terminated(), and wUdp.



Here is the call graph for this function:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=400pt]{df/d0a/main_8cpp_a0ddf1224851353fc92bfbff6f499fa97_cgraph}
\end{center}
\end{figure}


